{% extends "base.html" %}
{% block title %}Index{% endblock %}

{% block content %}
<div class="container" xmlns="http://www.w3.org/1999/html">
  Some brief definition (for user's convenience)
  <h3>Interface Overview</h3>
  <p>The interface you see below is what you will be using in this study. On the left hand side of the interface, you see 
    the routine listed, and its associated commands, aong with their respective boxes. In those boxes are where you can drag 
    and drop tags from the menus on the right hand side of the screen. The top menu lists the two "System Tags" you can assign
    a routine of command: Uninterruptible meaning that the system should not interrupt this routine or command under any circumstances, 
    and Pausible meaning the system can interrupt the routine or command if necessary. Below that is the "Self-Defined Tag" menu,
    where you can create your own tags and assign them to a routine. Self-Defined tags cannot be assigned to commands. Click the 
    "Add new tag" button when you would like to add a new Self-Defined tag. 
    </p>
    <br>
    <p>
    The tags in both menus are draggable, meaning you can click and hold on them to drag into the boxes associated with
    the routine or command. If you would like to remove a tag from a routine or command, simply click the "X" located
    next to that tag when it is in the box. (TODO Include demo video?)
     </p>
<!--  TODO -->
</div>
<br/>
{% for message in get_flashed_messages() %}
  <div class="container">
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  </div>
{% endfor %}

<div class="container">
<!--    Drag and drop reference: https://codepen.io/ovvn/pen/Nqxzjg -->
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">Tagging System Interface</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col">
          <!-- ---------------------------  -->
          <!--   Tagging at routine level   -->
          <!-- ---------------------------  -->
          <div class="row">
            <div class="col-md-6 col-xs-4">
              <b>Routine {{ idx }}</b>: {{ rtn_info["rtn_name"] }}
              <p><small><i>This is a {{ rtn_info["rtn_description"] }}</i></small></p>
            </div>
            <div class="dropzone col col-xs-4" id="dropzone-rtn" data-rid="{{ rid }}">
              {% if not rtn_sys_tag and not rtn_cus_tags %}
                &nbsp;
              {% endif %}
              {% if rtn_sys_tag %}
              <span class="btn btn-light tag-item-container">
                {{ rtn_sys_tag }}
                <button type="button" class="btn btn-default btn-xs remove tag-item"
                        onclick="window.location.href=
                        '{{ url_for('remove_rtn_sys_tag', rid=rid, idx=idx) }}';">
                   <i class="fa fa-trash fa-1" aria-hidden="true"></i>
                </button>
              </span>
              {% endif %}

              {% for cus_tag in rtn_cus_tags %}
              <span class="btn btn-light tag-item-container">
                {{ cus_tag }}
                <button type="button" class="btn btn-default btn-xs remove tag-item"
                        onclick="window.location.href=
                        '{{ url_for('remove_cus_tag', rid=rid, idx=idx, tag_name=cus_tag) }}';">
                  <i class="fa fa-trash fa-1" aria-hidden="true"></i>
                </button>
              {% endfor %}
              </span>
            </div>
          </div>
          <!-- ----------------------------- -->
          <!-- System tag for Command 1 only -->
          <!-- ----------------------------- -->
          {% if rtn_info["cmd1"] %}
            <div class="row">
              <div class="col-md-auto">
                <b>Command 1</b>: {{ rtn_info["cmd1"] }}
              </div>
              <div class="dropzone col" id="dropzone-cmd1">
                {% if cmd1_tag %}
                <span class="btn btn-light tag-item-container">
                  {{ cmd1_tag }}
                  <button type="button" class="btn btn-default btn-xs remove tag-item"
                          onclick="window.location.href=
                          '{{ url_for('remove_cmd1_tag', rid=rid, idx=idx) }}';">
                    <i class="fa fa-trash fa-1" aria-hidden="true"></i>
                  </button>
                </span>
                {% else %}
                  &nbsp;
                {% endif %}
              </div>
            </div>
          {% endif %}
          <!-- ----------------------------- -->
          <!-- System tag for Command 2 only -->
          <!-- ----------------------------- -->
          {% if rtn_info["cmd2"] %}
            <div class="row">
              <div class="col-md-auto">
                <b>Command 2</b>: {{ rtn_info["cmd2"] }}
              </div>
              <div class="dropzone col" id="dropzone-cmd2">
                {% if cmd2_tag %}
                <span class="btn btn-light tag-item-container">
                    {{ cmd2_tag }}
                    <button type="button" class="btn btn-default btn-xs remove tag-item"
                            onclick="window.location.href=
                            '{{ url_for('remove_cmd2_tag', rid=rid, idx=idx) }}';">
                      <i class="fa fa-trash fa-1" aria-hidden="true"></i>
                    </button>
                  </span>
                {% else %}
                  &nbsp;
                {% endif %}
              </div>
            </div>
          {% endif %}
          <!--   Browsing among different routines   -->
          <form action="{{ url_for('tag', idx=idx )}}" method="POST">
            {% if idx > 1 %}
              <input class="btn btn-outline-secondary"
                     type="submit" name="tag-page-action" value="Previous">
            {% endif %}
            {% if idx < total_rtn %}
              {% if rtn_sys_tag or rtn_cus_tags or cmd1_tag or cmd2_tag %}
                <input class="btn btn-outline-secondary"
                       type="submit" name="tag-page-action" value="Next">
              {% else %}
                <input class="btn btn-outline-secondary delay-loading"
                       type="submit" name="tag-page-action" value="Next">
              {% endif %}
            {% else %}
              {% if rtn_sys_tag or rtn_cus_tags or cmd1_tag or cmd2_tag %}
                <input class="btn btn-outline-primary"
                       type="submit" name="tag-page-action" value="Finish">
              {% else %}
                <input class="btn btn-outline-primary delay-loading"
                       type="submit" name="tag-page-action" value="Finish">
              {% endif %}
            {% endif %}
          </form>
        </div>

        <div class="col-md-5">
        <div class="right-panel">
          <!-- ---------------- -->
          <!-- System tag panel -->
          <!-- ---------------- -->
          <div class="card" style="margin-bottom:5px">
            <div class="card-body">
              <h5 class="card-title">System tags</h5>
                <a class="btn btn-outline-secondary">
                  <span class="drag drag-handle">No Interruption</span>
                </a>
                <a class="btn btn-outline-secondary">
                  <span class="drag drag-handle">OK to Pause</span>
                </a>
            </div>
          </div>
          <!-- ---------------- -->
          <!-- Self-defined tag panel -->
          <!-- ---------------- -->
          <div class="container">
            <!-- Button trigger modal -->
            <div class="modal fade" id="task-modal" tabindex="-1" aria-labelledby="Label" aria-hidden="true">
            <div class="modal-dialog modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="Label">Add a Tag</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <!-- Pop-up Session Input Area -->
              <div class="modal-body">
                <small><i>Please add a tag to show what you value for a routine.</i></small>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="task-form-display">Tag</span>
                  <input type="text" class="form-control data-tag-name"
                         placeholder="Tag name" aria-label="task-name"
                         aria-describedby="basic-addon1">
                </div>
                <small><i>Put a higher priority number (1-10) for tags you value more.</i></small>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="task-form-priority">Priority</span>
                  <input type="text" class="form-control tag-priority"
                         placeholder="priority (1-10), default 5" aria-label="task-name"
                         aria-describedby="basic-addon1">
                </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Close
                  </button>
                  <button id="submit-task" type="button" class="btn btn-primary">
                    Save changes
                  </button>
              </div>
            </div> <!-- End of modal-dialog modal-content -->
            </div>
          </div>
          <!--  Add tag button  -->
          <div class="card" style="margin-bottom:10px">
            <div class="card-body">
              <h5 class="card-title">
                <span>Self-Defined Routine Tags</span>
                <button type="button" class="btn btn-outline-info btn-sm float-right"
                      data-bs-toggle="modal" data-bs-target="#task-modal"
                      data-source="New Tag">
                Add New Tag
                </button>
              </h5>
              <div class="container table-responsive" style="margin-top:20px">
              <table class="table">
                <thead>
                <tr>
                    <th class="task">Tag Name</th>
                    <th class="status">Priority</th>
                    <th class="update">Edit</th>
                    <th class="update">Del.</th>
                </tr>
                </thead>

                <tbody>
                {% for tag in all_cus_tag %}
                  <tr>
                  <td>
                    <a class="btn btn-outline-secondary"
                       style="text-align:left; line-height:1.2">
                      <span class="drag drag-handle">{{ tag.name }}</span>
                    </a>
                  </td>
                  <td style="text-align:center">{{ tag.priority }}</td>
                  <td>
                    <button type="button" class="btn btn-outline-info btn-sm"
                            data-bs-toggle="modal" data-bs-target="#task-modal"
                            data-source="{{ tag.name }}" data-priority="{{ tag.priority }}">
                      <i class="fa fa-pen fa-1" aria-hidden="true"></i>
                    </button>
                  </td>
                  <td>
                    <button class="btn btn-outline-secondary btn-sm remove cus-tag-remove"
                            data-source="{{ tag.name }}" type="button">
                      <i class="fa fa-trash fa-1" aria-hidden="true"></i>
                    </button>
                  </td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
              </div> <!-- End of table area-->
              <small><i>Note: put higher priority for the tags you value more.</i></small>
            </div> <!-- End of Self-define tag card body for table -->
          </div> <!-- End of Self-define tag whole area -->
        </div>
      </div></div>  <!-- end of container for right panel -->
    </div>  <!-- end of card body -->
  </div> <!-- end of card -->
</div>

{% endblock %}